<!DOCTYPE html>
<html lang="en">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Greendash Dashboard</title>
    <!-- Iconic Fonts -->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="../vendors/iconic-fonts/font-awesome/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="../vendors/iconic-fonts/flat-icons/flaticon.css">
    <link rel="stylesheet" href="../vendors/iconic-fonts/cryptocoins/cryptocoins.css">
    <link rel="stylesheet" href="../vendors/iconic-fonts/cryptocoins/cryptocoins-colors.css">
    <!-- Bootstrap core CSS -->
    <link href="http://cdn.bootstrapmb.com/bootstrap/4.1.3/css/bootstrap.min.css" rel="stylesheet">
    <!-- jQuery UI -->
    <link href="../assets/css/jquery-ui.min.css" rel="stylesheet">
    <!-- Page Specific CSS (Slick Slider.css) -->
    <link href="../assets/css/slick.css" rel="stylesheet">
    <!-- Greendash styles -->
    <link href="../assets/css/style.css" rel="stylesheet">
    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="favicon.ico">

</head>

<body class="ms-body ms-aside-left-open ms-primary-theme ">


    <!-- Overlays -->
    <div class="ms-aside-overlay ms-overlay-left ms-toggler" data-target="#ms-side-nav" data-toggle="slideLeft"></div>

    <!-- 大页面左边导航 -->
    <aside id="ms-side-nav" class="side-nav fixed ms-aside-scrollable ms-aside-left">

        <!-- Logo -->
        <div id="logo" class="logo-sn ms-d-block-lg">
            <!-- logo的图片 -->
            <a class="pl-0 ml-0 text-center" href="index.html"> <img src="../assets/img/logo.png" alt="logo">
            </a>
        </div>

        <!-- 导航的一级菜单 -->
        <ul class="accordion ms-main-aside fs-14" id="side-nav-accordion">
            <!-- Dashboard -->
            <li class="menu-item">
                <a href="#" class="has-chevron" data-toggle="collapse" data-target="#dashboard" aria-expanded="false"
                    aria-controls="dashboard">
                    <span><i class="material-icons fs-16">dashboard</i>采购管理 </span>
                </a>
                <ul id="dashboard" class="collapse" aria-labelledby="dashboard" data-parent="#side-nav-accordion">
                    <li> <a href="./gongyingshangxinxi.html">供应商信息管理</a> </li>
                    <li> <a href="./yaopinxinxi.html">药品信息管理</a> </li>
                    <li> <a href="./add_caigoudan.html">采购单添加</a> </li>
                    <li> <a href="./caigoumingxi.html">采购明细管理</a> </li>
                </ul>
            </li>
            <li class="menu-item">
                <a href="#" class="has-chevron" data-toggle="collapse" data-target="#order-page" aria-expanded="false"
                    aria-controls="order-page">
                    <span><i class="fas fa-clipboard-list"></i>销售管理</span>
                </a>
                <ul id="order-page" class="collapse" aria-labelledby="order-page" data-parent="#side-nav-accordion">
                    <li> <a href="./add_xiaoshoudan.html">销售单添加管理</a> </li>
                    <li> <a href="./xiaoshoumingxi.html">销售明细管理</a> </li>
                </ul>
            </li>
            <li class="menu-item">
                <a href="#" class="has-chevron" data-toggle="collapse" data-target="#product-page" aria-expanded="false"
                    aria-controls="product-page">
                    <span><i class="fas fa-cannabis"></i>药店统计管理</span>
                </a>
                <ul id="product-page" class="collapse" aria-labelledby="product-page" data-parent="#side-nav-accordion">
                    <li> <a href="./rukutongji.html">入库统计</a> </li>
                    <li> <a href="./chukutongji.html">销售统计</a> </li>
                    <li> <a href="./kucunchaxun.html">库存查询</a> </li>
                </ul>
            </li>
            <li class="menu-item">
                <a href="#" class="has-chevron" data-toggle="collapse" data-target="#customer" aria-expanded="false"
                    aria-controls="customer">
                    <span><i class="fas fa-users"></i>人事管理</span>
                </a>
                <ul id="customer" class="collapse" aria-labelledby="customer" data-parent="#side-nav-accordion">
                    <li> <a href="add_yuangong.html">员工添加</a> </li>
                    <li> <a href="./yuangongguanli.html">员工管理</a> </li>
                </ul>
            </li>
            <li class="menu-item">
                <a href="#" class="has-chevron" data-toggle="collapse" data-target="#invoice" aria-expanded="false"
                    aria-controls="invoice">
                    <span><i class="fas fa-receipt"></i>打印管理</span>
                </a>
                <ul id="invoice" class="collapse" aria-labelledby="invoice" data-parent="#side-nav-accordion">
                    <li> <a href="./ruKuDan.html">入库单</a> </li>
                    <li> <a href="./chuKuDan.html">出库单</a> </li>
                </ul>
            </li>
            <li class="menu-item">
                <a href="#" class="has-chevron" data-toggle="collapse" data-target="#basic-elements"
                    aria-expanded="false" aria-controls="basic-elements">
                    <span><i class="material-icons fs-16">filter_list</i>系统管理</span>
                </a>
                <ul id="basic-elements" class="collapse" aria-labelledby="basic-elements"
                    data-parent="#side-nav-accordion">
                    <li> <a href="./xiuGaiMiMa.html">修改密码</a> </li>
                </ul>
            </li>
        </ul>
    </aside>
    <!-- 主体页面内容 -->
    <main class="body-content">
        <!-- 主题页面顶部导航 -->
        <nav class="navbar ms-navbar">
            <div class="ms-aside-toggler ms-toggler pl-0" data-target="#ms-side-nav" data-toggle="slideLeft">
                <span class="ms-toggler-bar bg-primary"></span>
                <span class="ms-toggler-bar bg-primary"></span>
                <span class="ms-toggler-bar bg-primary"></span>
            </div>
            <div class="logo-sn logo-sm ms-d-block-sm">
                <a class="pl-0 ml-0 text-center navbar-brand mr-0" href="index.html"><img
                        src="../assets/img/dashboard/greendash-logo-84x41.png" alt="logo"> </a>
            </div>
            <!-- 退出登录 -->
         <div style="display:flex;align-content:center;">
            <div style="line-height:60px;font-size: 18px;"><span id="loginSuName"></span>,欢迎你</div>
            <div id="outLogin"><a href="javascript:void(0);" id="logOut">退出登录</a></div>
         </div>


        </nav>

        <!-- 内容区域 -->
        <div class="ms-content-wrapper">
            <div class="row">
                <!-- 分页标 -->
                <div class="col-md-12">
                    <nav aria-label="breadcrumb">
                        <ol class="breadcrumb pl-0">
                            <li class="breadcrumb-item"><a href="./index.html">首页</a></li>
                            <li class="breadcrumb-item"><a href="./chukutongji.html">销售统计</a></li>
                        </ol>
                    </nav>
                </div>
                <!-- 筛选表单 -表格-->
                <div class="col-xl-12 col-md-12">
                    <div class="form-row">
                        <div class="col-md-3 mb-3">
                            <label for="validationCustom01">药品类别</label>
                            <div class="input-group">
                                <select class="form-control" id="validationCustom01" name="catelog_id" required="required">
                                    <option value="-1" disabled selected>---请选择---</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <label for="validationCustom02">药品名称</label>
                            <div class="input-group">
                                <select class="form-control" id="validationCustom02" name="goods_id" required="required">
                                </select>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <label for="validationCustom03">出库日期</label>
                            <div class="input-group">
                                <input type="date" class="form-control" id="validationCustom03" >
                            </div>
                        </div>
                        <div class="col-md-3 mb-3 select">
                            <button class="cktj_query_btn btn btn-success" type="button">查询</button>
                        </div>
                    </div>
                    <div class="ms-panel">
                        <div class="ms-panel-body">
                            <div class="table-responsive">
                                <table class="mytable table table-hover thead-primary">
                                    <thead>
                                        <tr>
                                            <th>药品名称</th>
                                            <th>出库数量</th>
                                            <th>出库时间</th>
                                            <th>负责人</th>
                                            <th>单据号</th>
                                        </tr>
                                    </thead>
                                    <tbody>

                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- 图形 -->
                <div class="col-xl-6 col-md-12">
                    <div class="ms-panel">
                        <div class="ms-panel-header">
                            <h6>统计</h6>
                        </div>
                        <div class="ms-panel-body">
                            <div class="chartjs-size-monitor"
                                style="position: absolute; inset: 0px; overflow: hidden; pointer-events: none; visibility: hidden; z-index: -1;">
                                <div class="chartjs-size-monitor-expand"
                                    style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1;">
                                    <div style="position:absolute;width:1000000px;height:1000000px;left:0;top:0"></div>
                                </div>
                                <div class="chartjs-size-monitor-shrink"
                                    style="position:absolute;left:0;top:0;right:0;bottom:0;overflow:hidden;pointer-events:none;visibility:hidden;z-index:-1;">
                                    <div style="position:absolute;width:200%;height:200%;left:0; top:0"></div>
                                </div>
                            </div>
                            <canvas id="pie-chart" width="454" height="227" class="chartjs-render-monitor"
                                style="display: block; width: 454px; height: 227px;"></canvas>
                        </div>
                    </div>
                </div>

            </div>
        </div>

    </main>
    <!-- SCRIPTS -->
    <!-- Global Required Scripts Start -->
    <script src="../assets/js/jquery-3.3.1.min.js"></script>
    <script src="../assets/js/popper.min.js"></script>
    <script src="http://cdn.bootstrapmb.com/bootstrap/4.1.3/js/bootstrap.min.js"></script>
    <script src="../assets/js/perfect-scrollbar.js"> </script>
    <script src="../assets/js/jquery-ui.min.js"> </script>
    <!-- Global Required Scripts End -->

    <!-- Page Specific Scripts Start -->
    <script src="../assets/js/moment.js"> </script>
    <script src="../assets/js/jquery.webticker.min.js"> </script>
    <script src="../assets/js/Chart.bundle.min.js"> </script>
    <script src="../assets/js/Chart.Financial.js"> </script>
    <!--  <script src="../assets/js/table-line.js"> </script>-->
    <!--  <script src="../assets/js/index-chart.js"> </script>-->

    <script src="../assets/js/d3.v3.min.js"> </script>
    <script src="../assets/js/topojson.v1.min.js"> </script>
    <!--  <script src="../assets/js/datamaps.all.min.js"> </script>-->
    <!--  <script src="../assets/js/index-map.js"> </script>-->






    <!-- Page Specific Scripts End -->

    <!-- Greendash core JavaScript -->
    <script src="../assets/js/framework.js"></script>

    <!-- Settings -->
    <script src="../assets/js/settings.js"></script>
    <script src="../assets/js/echarts.min.js"></script>

    <script type="text/javascript">


        $(function () {
            
            function timestampToTime(timestamp) {
                var date = new Date(timestamp);//时间戳为10位需*1000，时间戳为13位的话不需乘1000
                var Y = date.getFullYear() + '-';
                var M = (date.getMonth() + 1 < 10 ? '0' + (date.getMonth() + 1) : date.getMonth() + 1) + '-';
                var D = date.getDate() + ' ';
                var h = date.getHours() + ':';
                var m = date.getMinutes() + ':';
                var s = date.getSeconds();
//                return Y + M + D + h + m + s;
                return Y + M + D;
            }
            //入库统计查询
            $.ajax({
                url:"/chuKuTongJi",
                type:"get",
                dataType:"json",
                success:function(res){
                    $.each(res.data,function(index,item){
                        //采用ES6动态加载数据
                        $(".mytable > tbody").append(`
                                 <tr>
                                    <td>${item.name}</td>
                                    <td>${item.shuliang}</td>
                                    <td>${(timestampToTime(item.shijian))}</td>
                                    <td>${item.jingshouren}</td>
                                    <td>${item.danjuhao}</td>
                                </tr>
                         `)
                    });
                }
            });


            //药品类别
            $.ajax({
                url:"/queryCatelogList",
                type:"get",
                dataType:"json",
                success:function(res){
                    if(res.code == 200){//登录成功
                        $.each(res.data,function(index,item){
                            //采用ES6动态加载数据
                            $("#validationCustom01").append(`
                             <option value="${item.id}">${item.name}</option>
                            `)
                        });
                    }
                    if(res.code == 500){
                        alert(res.msg)
                    }
                }
            })

            //下拉别表选中触发
            $("#validationCustom01").on("change",function(){
                var catelog_id = $("#validationCustom01 option:selected").val();
                $("#validationCustom02").empty().append();//每次选择之前先清空药品名称
                //药品类别
                $.ajax({
                    url:"/queryYaoPinListByCatelogId",
                    type:"get",
                    data:{catelog_id:catelog_id},
                    dataType:"json",
                    success:function(res){
                        if(res.code == 200){
                            if(res.data.length == 0){//如果无二级数据
                                //采用ES6动态加载数据
                                $("#validationCustom02").append(`
                                   <option value="-1" disabled>--无药品选择--</option>
                                `)
                            }

                            $.each(res.data,function(index,item){
                                //采用ES6动态加载数据
                                $("#validationCustom02").append(`
                                   <option value="${item.id}">${item.name}</option>
                                `)
                            });
                        }
                        if(res.code == 500){
                            alert(res.msg)
                        }
                    }
                })
            })

            //点击条件查询
            $(".cktj_query_btn").click(function(){
                var goods_id  = $("#validationCustom02 option:selected").val();
                if(typeof goods_id == 'undefined'){
                    goods_id = null;
                }
                var shijian = $("#validationCustom03").val();
                $.ajax({
                    url: "/chuKuTongJiByCondition",
                    type: "post",
                    data: {goods_id:goods_id,shijian:shijian},
                    dataType: "json",
                    success: function (res) {
                        $(".mytable > tbody").empty().append();
                        $.each(res.data,function(index,item){
                            //采用ES6动态加载数据
                            $(".mytable > tbody").append(`
                                 <tr>
                                    <td>${item.name}</td>
                                    <td>${item.shuliang}</td>
                                    <td>${item.shijian}</td>
                                    <td>${item.jingshouren}</td>
                                    <td>${item.danjuhao}</td>
                                </tr>
                         `)
                        });
                    }
                });


            })


        })




    </script>

    <script>
        var myChart = echarts.init(document.getElementById('pie-chart'));
        $.ajax({
            url: "/chuKuTongJiEcharts",
            type: "get",
            dataType: "json",
            success: function (res) {
                var dataName = [];
                var dataShuliang = [];
                $.each(res.data,function(index,item){
                    dataName.push(item.name);
                    dataShuliang.push({value:item.total_shuliang,name:item.name});
                });
                // 指定图表的配置项和数据
                var option = {
                    title: {
                        text: '小药店管理药品采购统计',
                        subtext: '入库统计',
                        left: 'center'
                    },
                    tooltip: {
                        trigger: 'item',
                        formatter: '{a} <br/>{b} : {c} ({d}%)'
                    },
                    legend: {
                        orient: 'vertical',
                        left: 'left',
                        data: dataName
                    },
                    series: [
                        {
                            name: '访问来源小药店管理',
                            type: 'pie',
                            radius: '55%',
                            center: ['50%', '60%'],
                            data: dataShuliang,
                            emphasis: {
                                itemStyle: {
                                    shadowBlur: 10,
                                    shadowOffsetX: 0,
                                    shadowColor: 'rgba(0, 0, 0, 0.5)'
                                }
                            }
                        }
                    ]
                };
                // 使用刚指定的配置项和数据显示图表。
                myChart.setOption(option);
            }
        })

    </script>
</body>

</html>